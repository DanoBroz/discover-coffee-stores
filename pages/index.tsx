import Head from "next/head";
import styles from "../styles/Home.module.css";
import Banner from "../components/Banner";
import type { MouseEvent } from "react";
import Image from "next/image";
import Card from "../components/Card";
import coffeeStoresDummy from "../data/coffee-stores.json";
import { GetStaticProps } from "next";

export interface CoffeeStore {
    fsq_id: string;
    name: string;
    imgUrl: string;
    websiteUrl: string;
    address: string;
    neighbourhood: string;
}

interface HomeProps {
    coffeeStores: CoffeeStore[];
}

export const getStaticProps: GetStaticProps = async (context) => {
    const options = {
        method: "GET",
        headers: {
            accept: "application/json",
            Authorization: String(process.env.FOURSQUARE_API_KEY),
        },
    };

    const response = await fetch(
        "https://api.foursquare.com/v3/places/search?query=coffee&ll=49.828932%2C18.170823&limit=6",
        options
    );
    const coffeeStoresData = await response.json();

    return {
        props: {
            coffeeStores: coffeeStoresData.results,
        },
    };
};

export default function Home(props: HomeProps) {
    const { coffeeStores } = props;
    const handleClick = (e: MouseEvent) => {
        e.preventDefault();
        console.log("You clicked the button!");
    };

    return (
        <>
            <Head>
                <title>Coffee Connoisseur</title>
                <meta
                    name="description"
                    content="Generated by create next app"
                />
                <meta
                    name="viewport"
                    content="width=device-width, initial-scale=1"
                />
                <link rel="icon" href="/favicon.ico" />
            </Head>
            <main className={styles.main}>
                <Banner
                    buttonText="View stores nearby"
                    buttonFunction={handleClick}
                />
                <Image
                    src="/static/hero-image.png"
                    width={700}
                    height={400}
                    alt="hero - girl with coffee sitting on clouds"
                    className={styles.heroImage}
                />
                {coffeeStores.length && (
                    <>
                        <h2 className={styles.heading2}>Toronto stores</h2>
                        <div className={styles.cardLayout}>
                            {coffeeStores.map((store) => (
                                <Card
                                    key={String(store.fsq_id)}
                                    name={store.name}
                                    imageUrl={
                                        store.imgUrl ||
                                        coffeeStoresDummy[0].imgUrl
                                    }
                                    href={`/coffee-store/${store.fsq_id}`}
                                />
                            ))}
                        </div>
                    </>
                )}
            </main>
        </>
    );
}
